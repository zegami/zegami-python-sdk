name: zegami python sdk build
on:
  workflow_dispatch:
    branches:
      - main
    inputs:
      version:
        description: 'Version number'
        required: true
        default: '0.0.0-devci'
  push:
    paths:
    - "**"
jobs:
  package:
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@v2
    - run: make build
    - name: Make main branch build
      run: make package
      env:
        ZEGAMI_SDK_VERSION: ${{ github.event.inputs.version }}
        SDK_PRODUCTION_BUILD: 'true'
      if: github.ref == 'refs/heads/main'
    - name: Make dev branch build
      run: make package
      env:
        ZEGAMI_SDK_VERSION: ${{ github.event.inputs.version }}
      if: github.ref != 'refs/heads/main'
    - uses: actions/upload-artifact@v2
      with:
        name: wheel
        path: dist/*.whl
    - uses: actions/upload-artifact@v2
      with:
        name: archive
        path: dist/*.tar.gz

  lint:
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@v2
    - run: make lint
